{% extends 'base.html' %}

{% load static %}

{% block additional_css %}
  <link href="{% static "data-tables/css/jquery.dataTables.min.css" %}" rel="stylesheet">
  <link href="{% static "data-tables/css/jquery.dataTables_themeroller.css" %}" rel="stylesheet">
{% endblock additional_css %}

{% block content %}
  <h2>List of members</h2>

  <div class="btn-group">
    {% for s in seasons %}
      <a href="{% url 'members' %}?season_id={{ s.pk }}" class="btn btn-default {% if s.pk == season.pk %}btn-primary{% endif %}">
        {{ s.name }}
      </a>
    {% endfor %}
  </div>

  <br><br>

  {% if members %}
    <div class="content-panel">
      <div class="panel-heading"></div>
      <div class="panel-body">
        <table id="members-table" class="table">
          <thead>
            <tr>
              <th></th>
              <th>Player</th>
              <th>Meetups attended</th>
              <th>Games played</th>
              <th>Wins</th>
              <th>Loses</th>
              <th>Coefficient</th>
            </tr>
          </thead>
          <tbody>
            {% for member in members %}
              <tr>
                <td></td>
                <td>{{ member.name }}</td>
                <td>{{ member.meetups_attended }}</td>
                <td>{{ member.games_played }}</td>
                <td>{{ member.count_wins }}</td>
                <td>{{ member.count_loses }}</td>
                <td>{{ member.win_lose_coefficient|floatformat:2 }}</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div><!-- ./content-panel -->

    <br>
    <br>

    <div class="content-panel">
      <div class="panel-heading"></div>
      <div class="panel-body">
        <div id="coefficients-graph-container"></div>
      </div>
    </div><!-- ./content-panel -->
  {% endif %}
{% endblock content %}

{% block additional-scripts %}
  <!-- Data tables -->
  <script src="{% static 'data-tables/js/jquery.dataTables.min.js' %}" type="text/javascript"></script>

  <!-- Highcharts -->
  <script src="https://code.highcharts.com/highcharts.js"></script>

  <script>
    // enable dataTable
    $(document).ready(function () {
      var t = $("#members-table").DataTable({
        "paging": false,
        "info": false,
        "filter": false,
        "order": [[ 6, "desc" ]]
      });

      t.on( 'order.dt search.dt', function () {
        t.column(0, {search:'applied', order:'applied'}).nodes().each( function (cell, i) {
            cell.innerHTML = i+1;
        } );
    } ).draw();
    });
  </script>

  <script>
    // coefficients graph
    $(document).ready(function () {
      $.ajax({
        type: "GET",
        url: "{% url 'coefficients_over_meetups_graph' %}",
        data: {
          season_id: "{{ request.GET.season_id }}"
        },
        success: function(data) {
          $('#coefficients-graph-container').highcharts({
            chart: {
              zoomType: "x"
            },
            title: {
              text: 'Coefficients over time',
              x: -20 //center
            },
            xAxis: {
              categories: data.categories
            },
            yAxis: {
              title: {
                text: 'Coefficient'
              },
              plotLines: [{
                value: 0,
                width: 1,
                color: '#808080'
              }]
            },
            legend: {
              borderWidth: 0
            },
            plotOptions: {
              line: {
                lineWidth: 3,
                marker: {
                  enabled: false
                }
              }
            },
            series: data.series
          });
        }
      });
    });
  </script>
{% endblock additional-scripts %}